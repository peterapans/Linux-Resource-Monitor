# 项目设计文档

## 1. 项目概述

系统资源监视器（System Resource Monitor）是一个轻量级的工具，用于实时监控 Linux 系统的资源使用情况。该工具可以监控 CPU、内存、磁盘、GPU 和网络流量等重要资源，帮助用户了解系统的运行状态，并能及时发现系统资源的异常使用情况。

### 1.1 目标

本项目的目标是创建一个命令行工具，能够实时、定期地显示系统资源使用情况，并且具有较小的系统开销。

## 2. 系统架构

本系统基于 Linux 操作系统，并依赖 `/proc` 文件系统来获取系统的状态信息。工具使用 C 语言实现，按照模块化设计来分离不同功能的实现，主要包括以下模块：

### 2.1 主程序（`main.c`）

主程序负责启动并循环调用各个模块（CPU、内存、磁盘、GPU、网络流量监控）来获取系统资源数据，并输出到终端。

### 2.2 CPU 模块（`cpu.c` 和 `cpu.h`）

负责获取系统 CPU 使用率。通过解析 `/proc/stat` 文件来计算 CPU 的使用情况，包括用户态、系统态、空闲时间等数据。

### 2.3 内存模块（`memory.c` 和 `memory.h`）

负责获取系统内存使用情况。通过解析 `/proc/meminfo` 文件来读取总内存、空闲内存、已用内存等信息。

### 2.4 磁盘模块（`disk.c` 和 `disk.h`）

负责获取磁盘分区的使用情况。通过 `df` 命令获取磁盘的已用空间和空闲空间。

### 2.5 GPU 模块（`gpu.c` 和 `gpu.h`）

负责获取 GPU 使用率。通过 `nvidia-smi` 命令获取 GPU 的利用率和显存使用情况，前提是系统安装了 NVIDIA 驱动。

### 2.6 网络模块（`network.c` 和 `network.h`）

负责获取网络流量信息。通过读取 `/proc/net/dev` 文件，获取特定网络接口的接收和发送字节数。

## 3. 数据流和模块之间的交互

1. **主程序**：启动后会持续循环，定期调用各个模块的函数获取系统资源使用数据。每次获取的数据会被打印到终端。
2. **各模块之间的交互**：每个模块都独立获取对应的资源数据。主程序通过函数调用与各个模块交互，模块不直接交互。

## 4. 实现细节

### 4.1 CPU 使用率计算

- **原理**：通过读取 `/proc/stat` 中的 CPU 时间统计信息，计算当前 CPU 使用率。使用两次读取之间的差值来计算变化量，从而得出 CPU 使用率。

### 4.2 内存使用情况

- **原理**：读取 `/proc/meminfo` 中的 `MemTotal` 和 `MemFree` 值，通过差值计算已用内存，进而计算内存使用率。

### 4.3 磁盘使用情况

- **原理**：通过 `df` 命令获取磁盘分区的总容量、已用容量和可用容量，计算磁盘的使用率。

### 4.4 GPU 使用情况

- **原理**：使用 `nvidia-smi` 命令获取 GPU 的使用率和显存使用情况。

### 4.5 网络流量监控

- **原理**：读取 `/proc/net/dev` 文件，解析每个网络接口的接收字节数和发送字节数，通过计算两次读取之间的差值来获取流量信息。

## 5. 错误处理与日志记录

本项目对可能出现的错误进行了处理：
- 文件无法打开时，打印错误信息并退出。
- 无法读取必要的数据时，提示用户并终止程序。
- 在必要时进行日志记录，以便开发人员调试。

## 6. 性能优化

- 为避免频繁读取文件系统，程序采用了一秒刷新一次数据的设计，确保不对系统性能造成显著影响。
- 采用了高效的字符串解析方法，减少了对文件的重复读取。
